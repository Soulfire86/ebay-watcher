function setCookie(e,o,t){var n=new Date;n.setTime(n.getTime()+24*(t||30)*60*60*1e3);var a="expires="+n.toUTCString();document.cookie=e+"="+o+"; "+a}function getCookie(e){for(var o=e+"=",t=document.cookie.split(";"),n=0;n<t.length;n++){for(var a=t[n];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(o))return a.substring(o.length,a.length)}return""}var eBayWatcher=angular.module("eBayWatcher",["AccountController","SearchController","CategorySearchController","MyListController","UpdateItemController"]);$.ajax({type:"POST",url:"https://ebaywatcherwebapi.azurewebsites.net/Account",data:"json",success:function(e){alert("Got data"),console.log(e)}});var AccountController=angular.module("AccountController",[]);AccountController.controller("AccountController",["$scope","$http",function(e,o){function t(){o.defaults.headers.common.eBayWatcherToken=getCookie("eBayWatcherToken"),o.defaults.headers.common.eBayWatcherUsername=getCookie("eBayWatcherUsername"),e.loginStep="LoggedIn"}e.loading=!0,e.loginStep="StartingSession",e.eBayLoginUrl="",e.getState=function(){e.loading=!0,getCookie("eBayWatcherSession")&&getCookie("eBayWatcherLoginUrl")?(e.loginStep="AwaitingLogin",e.eBayLoginUrl=getCookie("eBayWatcherLoginUrl"),getCookie("eBayWatcherToken")&&getCookie("eBayWatcherUsername")?(t(),e.loading=!1):e.confirmLogin()):e.startLogin()},e.startLogin=function(){o.post("/Account").then(function(o){console.log("Got new session id "+o.data.SessionId),setCookie("eBayWatcherSession",o.data.SessionId),setCookie("eBayWatcherLoginUrl",o.data.LoginUrl),e.loginStep="AwaitingLogin",e.loading=!1,e.eBayLoginUrl=o.data.LoginUrl},function(o){e.loading=!1})},e.confirmLogin=function(){e.loading=!0,o.post("/Account/ConfirmLogin",{sessionId:getCookie("eBayWatcherSession")}).then(function(o){console.log("Got token "+o.data.Token+" for user "+o.data.Username),setCookie("eBayWatcherToken",o.data.Token),setCookie("eBayWatcherUsername",o.data.Username),t(),e.loading=!1},function(o){e.loading=!1,e.eBayLoginUrl=getCookie("eBayWatcherLoginUrl")})},e.getStatusMessage=function(){return"AwaitingLogin"===e.loginStep?"Not logged in":"Logged in as "+getCookie("eBayWatcherUsername")},e.getState(),e.logOut=function(){setCookie("eBayWatcherSession",""),setCookie("eBayWatcherToken",""),setCookie("eBayWatcherLoginUrl",""),setCookie("eBayWatcherUsername",""),e.loginStep="StartingSession",e.getState()}}]);var CategorySearchController=angular.module("CategorySearchController",[]);CategorySearchController.controller("CategorySearchController",["$scope","$http","$rootScope",function(e,o,t){e.searchTerm="",e.selectedCategory={id:null,name:"[Please select category]"},e.visible=!1,e.results=[],e.loading=!1,t.$on("OpenSelectCategoryWindow",function(){console.log("Opening select category window..."),e.visible=!0,document.getElementById("categorySearchBox").focus()}),e.backdropClicked=function(){e.visible=!1},e.contentClicked=function(e){e.stopPropagation()},e.search=function(){e.loading=!0,o.post("/Categories/Search",{searchTerm:e.searchTerm,eBayToken:getCookie("eBayWatcherToken")}).then(function(o){e.results=o.data,e.loading=!1,e.searched=!0},function(o){alert("error sending request"),e.loading=!1})},e.selectItem=function(o){t.$broadcast("CategorySelected",o),e.visible=!1}}]);var MyListController=angular.module("MyListController",[]);MyListController.controller("MyListController",["$scope","$http","$rootScope",function(e,o,t){e.loading=!1,e.newItem={},e.list=[],e.newItem.CategoryId=260,e.newItem.CategoryName="Stamps",e.selectCategory=function(){t.$broadcast("OpenSelectCategoryWindow")},t.$on("CategorySelected",function(o,t){console.log("received category selected"),console.log(t),e.newItem.CategoryId=t.Id,e.newItem.CategoryName=t.Name}),e.itemSelected=function(o){console.log("item selected"),console.log(o),t.$broadcast("Search",o),$.each(e.list,function(e,o){o.Selected=!1}),o.Selected=!0},e.addItem=function(t){if(!t.Name||t.Name.length<3)return void alert("Search text must be at least 3 characters long.");console.log("item added to list"),console.log(t);var n={Name:t.Name,SearchText:t.SearchText||t.Name,CategoryId:t.CategoryId,CategoryName:t.CategoryName};e.saving=!0,o.post("/WatchListItems",{Username:getCookie("eBayWatcherUsername"),Token:getCookie("eBayWatcherToken"),item:n}).then(function(o){var t=o.data;e.saving=!1,e.list.push(t)},function(o){e.saving=!1})},e.refresh=function(){o.get("/WatchListItems").then(function(o){e.list=o.data},function(e){})},e.refresh(),t.$on("RefreshList",function(o){e.refresh()})}]);var SearchController=angular.module("SearchController",[]);SearchController.controller("SearchController",["$scope","$http","$rootScope",function(e,o,t){e.loading=!0,e.searched=!1,t.$on("Search",function(o,t){e.search(t.SearchText,t.CategoryId)}),e.search=function(t,n){e.loading=!0,o.post("/EbaySearch",{searchTerm:t,categoryId:n}).then(function(o){e.results=o.data,e.loading=!1,e.searched=!0},function(o){e.loading=!1})},e.ignore=function(e){e.Ignore=!0},e.pin=function(e){e.Pin=!0},e.unpin=function(e){e.Pin=!1}}]);var UpdateItemController=angular.module("UpdateItemController",[]);UpdateItemController.controller("UpdateItemController",["$scope","$http","$rootScope",function(e,o,t){e.saving=!1,e.item=null,t.$on("Search",function(o,t){console.log("Received item selected message."),console.log(t),e.item=t}),e["delete"]=function(n){e.saving=!0,o["delete"]("/WatchListItems/"+n.Id).then(function(o){t.$broadcast("RefreshList"),e.saving=!1,e.item=null},function(o){e.saving=!1})}}]);